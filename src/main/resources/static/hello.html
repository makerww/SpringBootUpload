<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js "></script>
</head>
<body>

<form action="/upload" method="POST" enctype="multipart/form-data" name="post提交" target="targetIfr"
      onsubmit="return false">
  <p>file: <input type="file" id="file" name="file"></p>
  <input type="submit" value="提交" onclick="fileUpload()">
</form>
<iframe name="targetIfr" style="display:none"></iframe>
<p class="jd"></p>
<p class="result"></p>
<script>
  function fileUpload() {
    const file = $("#file")[0].files[0];
    upload(file, 0);
  }

  const upload = function (file, num) {

    //每一块大小
    let blockSize = 1024 * 1000 * 100;
    //总块数
    let blockNum = Math.ceil(file.size / blockSize);
    // 不够分块大小 取全部大小
    let nextSize = Math.min((num + 1) * blockSize, file.size);

    let fileblock = file.slice(num * blockSize, nextSize);

    const formData = new FormData();
    formData.append("file", fileblock);
    formData.append("fileName", file.name);
    formData.append("blockNum", blockNum);
    formData.append("blockIndex", (num + 1));
    $.ajax({
      url: "/upload",
      type: "POST",
      data: formData,
      //不要去处理发送的数据
      processData: false,
      // 不要去设置Content-Type请求头
      contentType: false,
      beforeSend() {
        console.log("beforeSend")
      },
      success: function (responseText) {
        $(".jd").html("上传进度--" + (num + 1) + "/" + blockNum);
        if (file.size <= nextSize) {
          $(".result").html("上传完成!");
          return;
        }
        upload(file, ++num);//递归调用
      }
    });

  }
</script>
</body>
</html>